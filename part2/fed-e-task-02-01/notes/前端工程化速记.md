> å·¥ç¨‹åŒ–ä¸ç­‰äºæŸä¸ªå·¥å…·ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—æŠ€æœ¯çš„é›†åˆå’Œåä½œã€‚ä¸€åˆ‡ä»¥æé«˜æ•ˆç‡ã€é™ä½æˆæœ¬å’Œè´¨é‡ä¿éšœä¸ºç›®çš„çš„æ‰‹æ®µéƒ½å±äºå·¥ç¨‹åŒ–ã€‚

â€‹

### å·¥ç¨‹åŒ–ä¸»è¦è§£å†³çš„é—®é¢˜


- ä¼ ç»Ÿè¯­è¨€å’Œè¯­æ³•çš„å¼Šç«¯ï¼ˆES6+ï¼ŒTypeScriptï¼ŒLessï¼‰
- æ— æ³•ä½¿ç”¨æ¨¡å—åŒ–/ç»„ä»¶åŒ–ï¼ˆimportï¼Œcommonjsï¼‰
- é‡å¤çš„æœºæ¢°æ€§å·¥ä½œï¼ˆæ‰“åŒ…ã€ä¸Šä¼ æœåŠ¡å™¨ï¼‰
- ä»£ç é£æ ¼ç»Ÿä¸€ã€è´¨é‡ä¿è¯ï¼ˆå¤šäººåä½œçš„ä»£ç é£æ ¼ï¼Œpull çš„ä»£ç è´¨é‡æ— æ³•ä¿è¯ï¼ŒESLintï¼‰
- ä¾èµ–åç«¯æœåŠ¡æ¥å£ï¼ˆMockï¼‰
- æ•´ä½“ä¾èµ–åç«¯é¡¹ç›®



ä¾‹å¦‚ï¼Œç°æœ‰é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªæ–°çš„ H5 é¡¹ç›®ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ°å·¥ç¨‹åŒ–çš„å·¥å…·ï¼Œé‚£ä¹ˆå°±ä¼šç¢°åˆ°ä¸‹é¢çš„å‡ ä¸ªé—®é¢˜ï¼š


1. éœ€è¦æ‰‹åŠ¨ä» `index.html` å¼€å§‹æ–°å»ºæ–‡ä»¶ï¼Œå±äºé‡å¤çš„æœºæ¢°å·¥ä½œ
1. å› ä¸ºæµè§ˆå™¨çš„ç‰ˆæœ¬é—®é¢˜ï¼Œå¯èƒ½æœ‰äº›æµè§ˆå™¨è¿˜ä¸æ”¯æŒ ES6+ çš„è¯­æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ H5 æ˜¯ä¸èƒ½æ”¯æŒECMA çš„æ–°ç‰¹æ€§çš„
1. å•ä¸ª js æ–‡ä»¶è¿‡äºè‡ƒè‚¿ï¼Œæ‹†åˆ†å¤šä¸ª js æ–‡ä»¶éœ€è¦ç†æ¸…å¤šä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¦å¤– html çš„å¼•å…¥é¡ºåºä¹Ÿæ˜¯éœ€è¦æœ‰åºçš„ï¼Œè€Œç°åœ¨çš„ webpack æ¨¡å—åŒ–å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜
1. å½“é¡¹ç›®æ˜¯ç”±å¤šäººåä½œå’Œç»´æŠ¤çš„æ—¶å€™ï¼Œæ¯ä¸ªäººçš„æœ¬åœ°ç¯å¢ƒä¸ä¸€æ ·å¯¼è‡´ä»£ç é£æ ¼ä¸ä¸€æ ·ï¼Œç¼©è¿›å’Œä»£ç æ ¼å¼åŒ–é—®é¢˜å¯¼è‡´æˆ‘ä»¬æäº¤åˆ°ä»“åº“æ—¶å€™æ–‡ä»¶ diff æ•ˆæœå¾ˆå·®
1. å¼€å‘è°ƒè¯•æ—¶ç›´æ¥æ‰“å¼€ `index.html` è¿›è¡Œè°ƒè¯•ï¼Œæ›´æ–°åæ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨
1. å¼€å‘ç¯å¢ƒå¼€å‘çš„æ—¶å€™æ¥å£å¿…ç„¶ä¼šç¢°åˆ°è·¨åŸŸé—®é¢˜ï¼Œéœ€è¦åœ¨æœ¬åœ°æˆ–è€…ç”±æœåŠ¡ç«¯åšä¸ªåå‘ä»£ç†
1. å¯¹æ¥æ¥å£å‰ï¼Œæ²¡æœ‰æ•°æ®çš„æ—¶å€™ä¼šåœ¨ä»£ç é‡ŒåµŒå…¥ mock çš„æ•°æ®ï¼Œä¸å¤Ÿä¼˜é›…
1. é¡¹ç›®éƒ¨ç½²ä½“ç§¯æ²¡æœ‰å‹ç¼©

â€‹

è€Œåœ¨å·¥ç¨‹åŒ–å·¥å…·æ¯”è¾ƒå®Œå–„çš„ä»Šå¤©ï¼Œä¸Šé¢çš„æ–°å»ºä¸€ä¸ª H5 é¡¹ç›®ï¼Œåªéœ€è¦å¼•å…¥æŠ€æœ¯æ ˆçš„ CLIï¼Œç»è¿‡ç®€å•çš„é…ç½®å°±èƒ½è§£å†³ä¸Šé¢å¤§éƒ¨åˆ†çš„é—®é¢˜ï¼Œæ— è®ºæ˜¯å¼€å‘æ•ˆç‡ã€è¿˜æ˜¯ç¼–ç è´¨é‡å¿…ç„¶æ˜¯ç›¸å¯¹ä¼ ç»Ÿçš„å¼€å‘æ–¹æ³•æœ‰ç€å·¨å¤§çš„æé«˜ã€‚
â€‹

### è„šæ‰‹æ¶çš„æ„ä¹‰
â€‹

è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®çš„æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠŸèƒ½ï¼Œæ›´æ·±çš„æ„ä¹‰æ˜¯ç»™æˆ‘ä»¬çš„é¡¹ç›®æä¾›è§„èŒƒå’Œçº¦å®šã€‚è¿™äº›çº¦å®šä¸»è¦æ˜¯ï¼š


1. ç»„ç»‡ç»“æ„
1. å¼€å‘è§„èŒƒ
1. æ¨¡å—ä¾èµ–
1. å·¥å…·é…ç½®
1. åŸºç¡€ä»£ç 

â€‹

PSï¼šæ­¤å¤„å¯ä»¥åˆ†ææ¯”è¾ƒæµè¡Œçš„è„šæ‰‹æ¶ Vue-CLIã€create-react-app ç­‰ã€‚
â€‹

### åŸºäº node ä»é›¶å¼€å§‹å®ç°ç®€å•çš„è„šæ‰‹æ¶


#### 1. ç¯å¢ƒå‡†å¤‡


- nodejs
- yarn/npm

â€‹

#### 2.  è„šæ‰‹æ¶çš„åŸºæœ¬ç»“æ„


```
scaffold
â”œâ”€ cli.js
â”œâ”€ node_modules
â”œâ”€ package.json
â””â”€ templates
       â”œâ”€ index.css
       â””â”€ index.html
```


å…·ä½“æ­¥éª¤ï¼š
â€‹


1. é¦–å…ˆéœ€è¦ä¸€ä¸ª `package.json` æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ init ä¸€ä¸‹

â€‹

> yarn init

â€‹


2. æœ‰äº† `package.json` æ–‡ä»¶åæˆ‘ä»¬éœ€è¦æ·»åŠ æˆ‘ä»¬çš„ CLI å…¥å£æ–‡ä»¶

â€‹

```json
{
  "name": "imu", // æˆ‘ä»¬çš„ CLI çš„åå­—
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "bin": "cli.js", // CLI çš„å…¥å£æ–‡ä»¶
}
```


3. æ¥ç€æ–°å»ºä¸€ä¸ªå…¥å£æ–‡ä»¶ `cli.js`

â€‹

```javascript
#!/usr/bin/env node

// Node CLI åº”ç”¨å¿…é¡»è¦æœ‰è¿™ä¸ªæ–‡ä»¶å¤´
// å¦‚æœæ˜¯ MacOS æˆ–è€… Linux éœ€è¦ä¿®æ”¹æ–‡ä»¶çš„è¯»å†™æƒé™ä¸º 755

console.log('hello cli');

```


4. åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªè½¯è¿æ¥å°±èƒ½ä½¿ç”¨æˆ‘ä»¬çš„ CLI å•¦

â€‹

```bash
yarn link

imu // è¾“å‡º hello cli
```


5. ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠ templates ç›®å½•ä¸‹å¸¦æœ‰ ejs æ ‡è®°çš„æ¨¡æ¿æ–‡ä»¶ï¼Œè¾“å‡ºåˆ°ç”¨æˆ·éœ€è¦åˆ›å»ºçš„ç›®å½•ä¸‹ï¼Œè¿™æ‰æ˜¯æˆ‘ä»¬è„šæ‰‹æ¶è¦åšçš„äº‹æƒ…

æ¨¡æ¿æ–‡ä»¶ï¼š
```html
<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= name %></title> <!-- ejs æ ‡è®° -->
</head>
<body>
  
</body>
</html>
```
css æ–‡ä»¶æ˜¯ html çš„ç®€å•æ ·å¼å°±ä¸è´´å‡ºæ¥äº†ã€‚
```javascript
#!/usr/bin/env node

console.log('cli.js');

const requirer = require('inquirer');
const fs = require('fs')
const path = require('path')
const ejs = requir		e('ejs')

// å‘½ä»¤è¡Œäº¤äº’è¯¢é—®ç”¨æˆ·é—®é¢˜
requirer.prompt([
  {
    type: 'input',
    name: 'name',
    message: 'Project Name?'
  }
]).then(anwsers => {
  // æ¨¡æ¿ç›®å½•
  const temDir = path.join(__dirname, 'templates')
  // ç›®æ ‡ç›®å½•
  const destDir = process.cwd()

  fs.readdir(temDir, (err, files) => {
    if(err) throw err
    files.forEach(file => {
      // ejs æ¸²æŸ“æ¨¡æ¿
      ejs.renderFile(path.join(temDir, file), anwsers, (err, result) => {
        if(err) throw err

        // å†™å…¥ç›®æ ‡æ–‡ä»¶è·¯å¾„
        fs.writeFileSync(path.join(destDir, file), result)
      })
    });
  })
})
```


6. æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç›´æ¥ä½¿ç”¨ imu å‘½ä»¤å°±èƒ½åˆ›å»ºæ ¹æ®æˆ‘ä»¬å‘½ä»¤è¡Œè¾“å…¥å¾—åˆ°æˆ‘ä»¬çš„ç»“æ„å’§

â€‹

### ä½¿ç”¨ Gulp æ„å»ºæˆ‘ä»¬çš„é¡¹ç›®


Gulp æ˜¯ä¸€ä¸ªåŸºäºæµï¼ˆstreamï¼‰çš„è‡ªåŠ¨æ„å»ºå·¥å…·ï¼Œå€ŸåŠ© Nodejs çš„èƒ½åŠ›å®ç°æˆ‘ä»¬å‰ç«¯çš„æ„å»ºä»»åŠ¡ã€‚Gulp æ„å»ºè¿‡ç¨‹çš„æ ¸å¿ƒå·¥ä½œæµç¨‹å’Œæˆ‘ä»¬æ‰‹åŠ¨å»å‹ç¼©æ›¿æ¢æ–°å»ºçš„è¿‡ç¨‹å¾ˆç±»ä¼¼ï¼Œåªä¸è¿‡å€ŸåŠ© Nodejs æŠŠæ‰‹åŠ¨å˜æˆäº†è‡ªåŠ¨ã€‚å®é™…ä¸Šä¸è®ºæ˜¯ Gulp è¿˜æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œéƒ½ç¦»ä¸å¼€ä¸‰ä¸ªè¿‡ç¨‹ï¼š
â€‹

![image.png](https://cdn.nlark.com/yuque/0/2021/png/372117/1629991610465-9a38c035-3509-42c5-a468-fb716160a24f.png#clientId=ud5c22649-ae12-4&from=paste&height=268&id=u1c1bcd25&margin=%5Bobject%20Object%5D&name=image.png&originHeight=535&originWidth=1789&originalType=binary&ratio=1&size=174566&status=done&style=none&taskId=uc2f6e629-d259-4561-8d38-3f37efd00e3&width=894.5)


è¿™å°±æ˜¯ Gulp æ„å»ºå·¥ç¨‹çš„æ ¸å¿ƒå·¥ä½œåŸç†ï¼Œç›¸æ¯” Grunt çš„ç£ç›˜è¯»å†™ï¼Œ Gulp çš„æ„å»ºè¿‡ç¨‹å‘ç”Ÿåœ¨å†…å­˜ä¸­ï¼Œæå¤§æé«˜ Gulp çš„æ„å»ºé€Ÿåº¦ã€‚ä¸è¿‡ä¸ç®¡ç”¨çš„æ˜¯ä»€ä¹ˆæ‰“åŒ…æ„å»ºå·¥å…·ï¼Œæˆ‘ä»¬çš„ç›®çš„éƒ½æ˜¯è§£æ”¾åŒæ‰‹ï¼Œæé«˜æ•ˆç‡ï¼Œå‡å°‘å¼€å‘æˆæœ¬ã€‚


#### 1. åŸºæœ¬å‡†å¤‡


æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯å°†ä¸‹é¢çš„é¡¹ç›®ä½¿ç”¨ Gulp æ¥è¿›è¡Œæ‰“åŒ…æ„å»ºï¼Œæ»¡è¶³ README.md çš„è¦æ±‚ã€‚
â€‹

é¡¹ç›®æ–‡ä»¶ï¼š[pages-boilerplate.zip](https://www.yuque.com/attachments/yuque/0/2021/zip/372117/1629984312504-678b2bba-7a79-4a58-a926-ef02f28d283c.zip?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2021%2Fzip%2F372117%2F1629984312504-678b2bba-7a79-4a58-a926-ef02f28d283c.zip%22%2C%22name%22%3A%22pages-boilerplate.zip%22%2C%22size%22%3A70176%2C%22type%22%3A%22application%2Fzip%22%2C%22ext%22%3A%22zip%22%2C%22status%22%3A%22done%22%2C%22taskId%22%3A%22u6143f3c8-9111-425f-b185-bb13c83573e%22%2C%22taskType%22%3A%22upload%22%2C%22id%22%3A%22uc2216e0b%22%2C%22card%22%3A%22file%22%7D)


æˆ‘ä»¬ç²—ç•¥æ¥é˜…è¯»ä¸€ä¸‹ README é‡Œçš„ä¸»è¦å‡ ä¸ªå‘½ä»¤ï¼š
â€‹


- Lintï¼ˆæ£€æŸ¥ style & scriptsï¼‰
- Compileï¼ˆç¼–è¯‘ style & scripts & pagesï¼‰
- Serveï¼ˆå¼€å‘æ¨¡å¼ä¸‹å¯åŠ¨æœåŠ¡å’Œçƒ­æ›´æ–°ï¼‰ï¼Œæ”¯æŒæŒ‡å®šç«¯å£å’Œæ˜¯å¦æ‰“å¼€æµè§ˆå™¨
- Buildï¼ˆæ„å»º app åˆ° dist æ–‡ä»¶å¤¹ä¸‹ï¼‰
- Startï¼ˆç”Ÿäº§æ¨¡å¼ä¸‹è¿è¡Œé¡¹ç›®ï¼‰ï¼ŒåŒæ ·æ”¯æŒæŒ‡å®šç«¯å£å’Œæ˜¯å¦æ‰“å¼€æµè§ˆå™¨
- Deployï¼ˆéƒ¨ç½² dist æ–‡ä»¶å¤¹ä¸‹åˆ° [GitHub Pages](https://pages.github.com)ï¼‰ï¼Œæ”¯æŒ push åˆ°æŒ‡å®šåˆ†æ”¯
- Cleanï¼ˆæ¸…é™¤å·²äº§ç”Ÿçš„ dist å’Œ temp æ–‡ä»¶ï¼‰

â€‹

å¥½å•¦ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“æˆ‘ä»¬çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œåœ¨é¡¹ç›®ä½¿ç”¨ Gulp æ¥å®ç°ä¸Šé¢çš„å‘½ä»¤ï¼Œhere we go~ğŸ‰
â€‹

#### 2. é¡¹ç›®æ–‡ä»¶åˆ†æ


ä»é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ä¸­æˆ‘ä»¬èƒ½å‘ç°æœ‰è¿™äº›æ–‡ä»¶ç±»å‹ï¼š
â€‹


- å¸¦ Swig æ ‡è®°çš„ HTML æ–‡ä»¶
- Sass æ–‡ä»¶
- ä½¿ç”¨ ES6 çš„ JS æ–‡ä»¶
- å­—ä½“å’Œå›¾ç‰‡æ–‡ä»¶

â€‹

é‚£ä¹ˆè¦åšçš„äº‹æƒ…ä¹Ÿæ˜¾è€Œæ˜“è§äº†ã€‚
â€‹


1. ç¼–è¯‘ HTML æ¨¡æ¿ï¼Œå¼•å…¥ä¾èµ–çš„ scripts & styles
1. ç¼–è¯‘ Sass ä¸º CSSï¼Œæ•´åˆ CSS æ–‡ä»¶å¹¶ä¸”å‹ç¼©å¤„ç†
1. ç¼–è¯‘ ES6 ä¸º ES5ï¼Œæ•´åˆ JS æ–‡ä»¶å¹¶ä¸”å‹ç¼©å¤„ç†
1. å­—ä½“å’Œå›¾ç‰‡ç­‰é™æ€èµ„æºå‹ç¼©åç§»åˆ° dist ç›®å½•



#### 3. ç¼–å†™ gulpfile.js æ–‡ä»¶


å…³äº Gulp æä¾›çš„ API å…¶å®ä¹Ÿä¸å¤šï¼Œè¿™é‡Œå°±ä¸å¤šæï¼Œæ›´å¤šæ–¹æ³•äº†è§£å®˜æ–¹æ–‡æ¡£ï¼š[API](https://www.gulpjs.com.cn/docs/api/concepts/)ã€‚


é¦–å…ˆæˆ‘ä»¬ä»æœ€ç®€å•çš„ç¼–è¯‘ HTML æ¨¡æ¿å¼€å§‹ï¼Œé¡¹ç›®ä¸­ç”¨åˆ°çš„æ˜¯ Swig æ¨¡æ¿è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… `gulp-swig` åˆ°å¼€å‘ä¾èµ–ã€‚ç„¶åç¼–å†™ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼š
â€‹


1. **HTML æ¨¡æ¿**
```javascript
const { src, dest } = require("gulp");
const swig = require("gulp-swig");

const page = () => {
  return src("src/*.html", { base: "src" }) // base ä¿ç•™æ–‡ä»¶è·¯å¾„
    .pipe(swig())
    .pipe(dest("dist"));
};
```
 

2. **Sass æ–‡ä»¶**



ç„¶åæ˜¯ sass å¼€å§‹ï¼Œå…¶ä»–çš„ css é¢„å¤„ç†å™¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚
â€‹

Tipsï¼šå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ `gulp-sass` ç”¨çš„ `^5.0.0`ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… `node-sass` æˆ–è€… `sass`ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¼šé»˜è®¤å®‰è£… `node-sass`ã€‚
```javascript
const sass = require('gulp-sass')(require('sass')) 

const style = () => {
  return src("src/assets/styles/*.scss", { base: "src" })
    .pipe(sass())
    .pipe(dest("dist"))
};
```


3. **JS æ–‡ä»¶**

**â€‹**

è½¬åŒ– ES6 éœ€è¦ç”¨åˆ° babelï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸‹é¢å‡ ä¸ªæ’ä»¶ï¼š
â€‹


- gulp-babel
- @babel/core
- @babel/perset-env ï¼ˆä½œç”¨ï¼šæ ¹æ®å¼€å‘è€…çš„é…ç½®ï¼ŒæŒ‰éœ€åŠ è½½æ’ä»¶ï¼‰

â€‹

```javascript
const babel = require("gulp-babel");

const script = () => {
  return src("src/assets/scripts/*.js", { base: "src" })
    .pipe(babel({ presets: ["@babel/preset-env"] }))
    .pipe(dest("dist"));
};
```
##### 

4. **å›¾ç‰‡**

**â€‹**

ä¸€å¼ å›¾ç‰‡çš„ä½“ç§¯å¯èƒ½ç›¸å½“äºå‡ åä¸ªçš„ä»£ç æ–‡ä»¶è¿™ä¸€ç‚¹ä¹Ÿä¸å¤¸å¼ ï¼Œå›¾ç‰‡å’Œå­—ä½“è¿™äº›é™æ€æ–‡ä»¶çš„è½¬æ¢æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ° `gulp-imagemin` è¿™ä¸ªæ’ä»¶æ¥å‹ç¼©ã€‚
â€‹

æ³¨æ„ï¼Œç°åœ¨å†™çš„æ—¶å€™ `gulp-imagemin` ç‰ˆæœ¬ä¸º 8.0.0ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸‹ç›´æ¥ require ä¼šæŠ¥é”™ï¼ŒæŠŠç‰ˆæœ¬é€€ä¸º 7.0.0 å³å¯ã€‚
â€‹

```javascript
const imagemin = require('gulp-imagemin');

const image = () => {
  return src("src/assets/images/**", { base: "src" })
    .pipe(imagemin())
    .pipe(dest('dist'))
}
```


5. **å­—ä½“**

**â€‹**

å­—ä½“çš„å‹ç¼©æ–¹å¼å’Œå›¾ç‰‡ä¸€æ ·ï¼Œç”¨çš„éƒ½æ˜¯ `gulp-imagemin`ã€‚å¯¹äºä¸èƒ½è½¬æ¢çš„å­—ä½“æ ¼å¼ï¼Œ`gulp-imagemin` å°†ä¸è¿›è¡Œä»»ä½•å¤„ç†ã€‚
â€‹

```javascript
const font = () => {
  return src("src/assets/fonts/**", { base: "src" })
    .pipe(imagemin())
    .pipe(dest('dist'))
}
```


6. **ä»»åŠ¡ç»„åˆ**



ä¸Šé¢çš„å®šä¹‰çš„ä»»åŠ¡å®Œæˆäº†å¯¹é¡¹ç›®çš„èµ„æºæ–‡ä»¶çš„å‹ç¼©å’Œç¼–è¯‘ï¼Œå‰©ä¸‹çš„éœ€è¦å¯¹è¿™äº›ä»»åŠ¡è¿›è¡Œç»„åˆæ•´ç†å’Œä¼˜åŒ–ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‰§è¡Œé¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚è¿™é‡Œæ¶‰åŠåˆ° Gulp çš„ä¸¤ä¸ªå…³é”®ç»„åˆä»»åŠ¡ç”¨çš„ APIï¼š
â€‹


- **series**
- **parallel**



è¿™ä¸¤ä¸ª API çš„å…³ç³»ä¸æˆ‘ä»¬çš„åˆä¸­å­¦çš„ç”µè·¯ä¸­çš„ä¸²è”å’Œå¹¶è”çš„å…³ç³»å¾ˆç›¸ä¼¼ã€‚


series ç”¨äº**é¡ºåºæ‰§è¡Œ**éœ€è¦ç»„åˆçš„å„ä¸ªä»»åŠ¡ï¼Œè€Œ parallel ç”¨äº**å¹¶å‘æ‰§è¡Œ**éœ€è¦ç»„åˆçš„ï¼Œä¸¤ä¸ªæ–¹æ³•å¯ä»¥å†äº’ç›¸åµŒå¥—å’Œç»„åˆï¼Œå¹¶ä¸”åµŒå¥—çš„å±‚çº§ä¸ä½œé™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œä»»æ„çš„ç»„åˆã€‚
â€‹

ä»ä¸Šé¢çš„å®šä¹‰çš„ä»»åŠ¡èƒ½çŸ¥é“ï¼Œè¿™äº›ä»»åŠ¡çš„ç¼–è¯‘å‹ç¼©éƒ½æ˜¯äº’ä¸å½±å“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›å¯ä»¥å¹¶å‘æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚
â€‹

```javascript
const { parallel } = require("gulp");

const compile = parallel(page, style, script, image, font)
```


è¿™æ ·å°±å®Œæˆå¹¶å‘ä»»åŠ¡çš„ç»„åˆäº†ï¼Œç°åœ¨æ‰§è¡Œ compile ä»»åŠ¡èƒ½å¹¶å‘çš„æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„æ–‡ä»¶å‹ç¼©ç¼–è¯‘ä»»åŠ¡ã€‚ç°åœ¨æ¯æ¬¡ç¼–è¯‘éƒ½ä¼šäº§ç”Ÿ dist ç›®å½•ï¼Œæ¯æ¬¡ç¼–è¯‘å‰æˆ‘ä»¬éœ€è¦æ¸…ç†ä¸€ä¸‹ä¸Šæ¬¡çš„ç¼–è¯‘äº§ç”Ÿçš„ dist ç›®å½•ï¼Œæ‰€éœ€å†æ¥å®šä¹‰ä¸ª clean ä»»åŠ¡ã€‚
â€‹

è¿™é‡Œç”¨åˆ°ä¸€ä¸ª `del` çš„ npm åŒ…ï¼Œç”¨äºåˆ é™¤æŒ‡å®šçš„ç›®å½•å’Œæ–‡ä»¶ã€‚è¿™ä¸ªåŒ…ä¸æ˜¯ Gulp çš„æ’ä»¶ï¼Œä½†æ˜¯ç”±äº Gulp çš„ä»»åŠ¡æ”¯æŒè¿”å› Promiseï¼Œè€Œè¿™ä¸ªåŒ…åˆšå¥½æ˜¯è¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ Gulp æ¥ä½¿ç”¨ã€‚
â€‹

```javascript
const del = require('del')

const clean = () => del(["dist"]);
```


ç»„åˆä¸‹æˆä¸ºä¸€ä¸ª build ä»»åŠ¡ï¼Œå¼„ä¸”å°† cleanã€compile å’Œ build å¯¹æ–¹æš´éœ²å‡ºæ¥ï¼Œæä¾›æˆ‘ä»¬ä½¿ç”¨
â€‹

```javascript
const build = series(clean, parallel(compile, extra));

module.exports = {
  clean,
  compile,
  build
}
```


7. **å¼€å‘æœåŠ¡å™¨**

**â€‹**

ç»è¿‡ä¸Šé¢çš„æ­¥éª¤æˆ‘ä»¬å·²ç»èƒ½å®Œæˆå“åº”æ–‡ä»¶çš„ç¼–è¯‘å’Œå­—ä½“å›¾ç‰‡çš„å‹ç¼©ï¼Œæœ€ç»ˆçš„æ–‡ä»¶éƒ½ä¼šæ”¾åœ¨ dist ç›®å½•ä¸‹ã€‚æ¥ä¸‹æ¥å°±èƒ½å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå¯¹dist ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œç›‘è§†ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–å°±è‡ªåŠ¨æ‰§è¡Œå“åº”çš„ä»»åŠ¡ï¼Œè¾¾åˆ°çƒ­æ›´æ–°çš„æ•ˆæœã€‚
â€‹

è¿™é‡Œç”¨åˆ° `browser-sync` è¿™ä¸ªæ’ä»¶ï¼Œæ›´å¤šçš„ API å¯ä»¥æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ã€‚
â€‹

æ³¨æ„ï¼šæœ€æ–°çš„ `browser-sync` çš„ reload æ–¹æ³•è²Œä¼¼ä¸ sass çš„ç¼–è¯‘çš„æœ‰å†²çªï¼Œ`browser-sync@2.21.0` ç‰ˆæœ¬æ­£å¸¸ã€‚
â€‹

```javascript
const bs = require("browser-sync").create();

const serve = () => {
  // ç›‘è§†æ–‡ä»¶æ”¹åŠ¨ï¼Œæ‰§è¡ŒæŒ‡å®šä»»åŠ¡
  watch("./src/*.html", page, bs.reload);
  watch("./src/assets/styles/*.scss", style, bs.reload);
  watch("./src/assets/scripts/*.js", script, bs.reload);

  // é™æ€èµ„æºã€å­—ä½“å’Œæ ·å¼ä¸éœ€è¦æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ï¼Œå‡å°‘æ„å»ºçš„ä»»åŠ¡æé«˜æ„å»ºæ•ˆç‡
  watch(
    ["./src/assets/images/**", "./src/assets/fonts/**", "./public/**"],
    bs.reload
  );

  return bs.init({
    port: 2080, // é»˜è®¤ç«¯å£
    open: false, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€
    notify: false, // æœåŠ¡å™¨è¿æ¥çŠ¶æ€æç¤º
    server: {
      baseDir: ["dist", "src", "public"],
      routes: {
        "/node_modules": "node_modules", 
      },
    },
  });
};
```


8. **è·¯å¾„å¤„ç†**

**â€‹**

æ‰“å¼€ dist ç›®å½•ä¸‹çš„ html æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢çš„éƒ¨åˆ† CSS å’Œ JS æ–‡ä»¶å¼•å…¥éƒ½æ˜¯ä» `node_modules` ä¸‹å¼•å…¥çš„ã€‚æˆ‘ä»¬å‘å¸ƒä»£ç æ˜¯æ²¡æœ‰ `node_modules` çš„ï¼Œæ‰€ä»¥éœ€è¦å°† html æ–‡ä»¶å†…çš„è·¯å¾„æ•´åˆæ‰“åŒ…ï¼Œç„¶åå¼•å…¥å¤„ç†è¿‡åçš„æ–‡ä»¶ã€‚
â€‹

è¿™é‡Œç”¨åˆ° `gulp-useref` è¿™ä¸ªæ’ä»¶ï¼Œæ ¹æ® html ç‰¹å®šçš„æ³¨é‡Šè§„åˆ™ï¼Œè¿›è¡Œæ–‡ä»¶çš„åˆå¹¶ã€‚å› ä¸º `gulp-useref` åªè´Ÿè´£åˆå¹¶æ–‡ä»¶ï¼Œä¸ä¼šè´Ÿè´£å…¶ä»–å¤„ç†ï¼Œæ‰€ä»¥é€šå¸¸ä¼šæ­é… `gulp-if` ä½¿ç”¨ï¼Œå®Œæˆå¯¹ä¸åŒæ–‡ä»¶çš„å¤„ç†ã€‚
â€‹

åœ¨ä½¿ç”¨ `gulp-useref` ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æå‰åšä¸€ä¸ªå¤„ç†ã€‚å°† `page` ã€`style` å’Œ `script` ä»»åŠ¡çš„è¾“å‡ºä½ç½®éƒ½æ”¹æˆ temp çš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¦é¿å…ä½¿ç”¨ `gulp-useref`
 å¤„ç† htmlã€css å’Œ js æ–‡ä»¶çš„æ—¶å€™ï¼Œå‡ºç°äº†å¯¹è¿™äº›æ–‡ä»¶è¾¹è¯»è¾¹å†™çš„å†²çªé—®é¢˜ã€‚
â€‹

```javascript
const useref = () => {
  return src("temp/*.html", { base: "temp" })
    .pipe(plugins.useref({ searchPath: ["temp", "."] }))
    .pipe(plugins.if(/\.js$/, plugins.uglify()))
    .pipe(plugins.if(/\.css$/, plugins.cleanCss()))
    .pipe(
      plugins.if(
        /\.html$/,
        plugins.htmlmin({
          // å‹ç¼© html æ–‡ä»¶å†…å®¹
          collapseWhitespace: true,
          minifyCSS: true,
          minifyJS: true,
        })
      )
    )
    .pipe(dest("dist"));
};
```


æ¥ç€æŠŠè¿™ä¸ªä»»åŠ¡æ”¾è¿› build ä»»åŠ¡ä¸­ï¼Œç”¨äºæ‰“åŒ…ä¸Šçº¿ä»£ç ã€‚
â€‹

```javascript
const build = series(
  clean,
  parallel(series(compile, useref), image, font, extra)
);
```


