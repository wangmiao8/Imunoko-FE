## 简答题

#### 谈谈你是如何理解 JS 异步编程的，EventLoop、消息队列都是做什么的，什么是宏任务，什么是微任务？

**答:**

#### 1. 异步编程

JS 执行是单线程，但浏览器不是。所以 JS 可以把一些耗时任务交给其他线程处理，并且定义任务结束后的回调函数，JS 继续执行，等其他线程处理完成再放入 JS 的执行栈，处理这些异步任务的回调函数。

我的理解是：**编写这些耗时任务并且指定任务结束后的回调函数的 JS 程序，就是 JS 的异步编程**

回调函数是 JS 异步编程的基础，在此基础上延伸出的事件机制、发布订阅模式等都归为异步编程。

#### 2. EventLoop 和 消息队列

**事件循环（EventLoop），是 JS 的执行机制。**用于收集事件，对任务进行排队以便在合适的时候执行回调。

JS 的执行可以拆分成几个部分：主线程的执行栈、APIs 线程、消息队列。

执行栈用于执行 JS 代码；APIs 线程用于执行异步任务；消息队列用于存放异步任务结束后的回调，当执行栈清空后把回调 push 到执行栈执行。

EventLoop 机制会不断的循环下面的过程：

> 1.主线程执行栈同步执行，碰到异步操作放入 APIs 线程执行，继续执行代码  
> 2.异步任务完成，将回调到放入消息队列排队等待执行  
> 3.执行栈清空，消息队列依次放入执行栈执行

PS：Node 的事件循环有点区别，但是对 Node 不太熟悉，所以这个回答是对于浏览器的。

#### 3. 宏任务 和 微任务

JS 的异步任务可以分为宏任务和微任务。宏任务和微任务都是对一些 JS 的异步 API 的称呼而已。

宏任务：script、定时器、UI rendering、postMessage、I/O  
微任务：Promise、process.nextTick（node）

区别：宏任务由宿主发起（浏览器、node），微任务由 JS 引擎发起。

优先级：每次执行栈清空后会立即处理完所有微任务队列中的事件，然后再去宏任务队列中取下一个事件。同一个事件循环，微任务永远在宏任务之前执行。
